<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>Graphql Performance Optimization - Software Unicorns</title><meta name=Description content="Eliminate N+1 Database Queries in GraphQL with Data Loader."><meta property="og:title" content="Graphql Performance Optimization">
<meta property="og:description" content="Eliminate N+1 Database Queries in GraphQL with Data Loader.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/"><meta property="og:image" content="https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-10-01T00:00:00+00:00">
<meta property="article:modified_time" content="2021-10-01T00:00:00+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png">
<meta name=twitter:title content="Graphql Performance Optimization">
<meta name=twitter:description content="Eliminate N+1 Database Queries in GraphQL with Data Loader.">
<meta name=application-name content="Software Unicorns">
<meta name=apple-mobile-web-app-title content="Software Unicorns"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/><link rel=prev href=https://softwareunicorns.com/posts/google-wellbeing-manifesto/><link rel=next href=https://softwareunicorns.com/posts/messy-ui-think-in-components/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Graphql Performance Optimization","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/softwareunicorns.com\/posts\/graphql-typedi-data-loaders-and-scoped-containers\/"},"image":[{"@type":"ImageObject","url":"https:\/\/softwareunicorns.com\/posts\/graphql-typedi-data-loaders-and-scoped-containers\/featured-image.png","width":1200,"height":347}],"genre":"posts","keywords":"graphql, typescript, type-graphql, typdi, optimization","wordcount":917,"url":"https:\/\/softwareunicorns.com\/posts\/graphql-typedi-data-loaders-and-scoped-containers\/","datePublished":"2021-10-01T00:00:00+00:00","dateModified":"2021-10-01T00:00:00+00:00","publisher":{"@type":"Organization","name":"Abner Qian"},"author":{"@type":"Person","name":"Abner Qian"},"description":"Eliminate N+1 Database Queries in GraphQL with Data Loader."}</script></head>
<body header-desktop header-mobile><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':''==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:''==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Software Unicorns"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo.svg data-srcset="/logo.svg, /logo.svg 1.5x, /logo.svg 2x" data-sizes=auto alt=/logo.svg title=/logo.svg>Software Unicorns</a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/about> About </a><a class=menu-item href=/posts/> Posts </a><a class=menu-item href=/tags/> Tags </a><a class=menu-item href=/categories/> Categories </a><span class="menu-item delimiter"></span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Software Unicorns"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/logo.svg data-srcset="/logo.svg, /logo.svg 1.5x, /logo.svg 2x" data-sizes=auto alt=/logo.svg title=/logo.svg>Software Unicorns</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><a class=menu-item href=/about title>About</a><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class=toc-content id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">Graphql Performance Optimization</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=https://github.com/Blargel title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw"></i>Abner Qian</a></span>&nbsp;<span class=post-category>included in <a href=/categories/backend/><i class="far fa-folder fa-fw"></i>backend</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2021-10-01>2021-10-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;917 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;5 minutes&nbsp;</div>
</div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png data-srcset="/posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png, /posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png 1.5x, /posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png 2x" data-sizes=auto alt=/posts/graphql-typedi-data-loaders-and-scoped-containers/featured-image.png title="Eliminate N+1 Database Queries in GraphQL with Data Loader."></div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#application-architecture>Application Architecture</a></li>
<li><a href=#the-n1-problem>The N+1 Problem</a></li>
<li><a href=#data-loaders>Data Loaders</a></li>
</ul>
</nav></div>
</div><div class=content id=content><p>While working on a project for a client, we came across an interesting twist to a common problem. We were tasked with making the API backend that powers a mobile app called <a href=https://www.playhouse.so/ target=_blank rel="noopener noreffer">Playhouse</a>, a mobile app that displays real estate listings to its users in a nice little video package. We decided to make a <a href=https://graphql.org/ target=_blank rel="noopener noreffer">GraphQL</a> API and got to building. During the design process, we made a point of keeping it maintainable for the long run.</p>
<h2 id=application-architecture>Application Architecture</h2>
<p>This backend is a <a href=https://nodejs.org/en/ target=_blank rel="noopener noreffer">Node.js</a> application with a <a href=https://www.postgresql.org/ target=_blank rel="noopener noreffer">PostgreSQL</a> database. Since we were also using <a href=https://www.typescriptlang.org/ target=_blank rel="noopener noreffer">TypeScript</a>, we decided to use <a href=https://typegraphql.com/ target=_blank rel="noopener noreffer">TypeGraphQL</a> to handle our GraphQL needs. Finally, one of the steps we took to improve maintainability was to use the dependency injection design pattern with the help of <a href=https://github.com/typestack/typedi target=_blank rel="noopener noreffer">TypeDI</a>.</p>
<h2 id=the-n1-problem>The N+1 Problem</h2>
<p>Those who have worked will GraphQL will likely be familiar with this problem already. When implementing a resolver for an object, if you just hit the database as soon as the resolver is called, you&rsquo;ll end up querying the database more than neccesary - sometimes a <em>lot</em> more than necessary.</p>
<p>Let&rsquo;s take a look at an example. In our API, we have listings, comments, and users. A listing can have multiple comments, and the comments are authored by users. When looking up a listing, its comments, and the comments' authors, the GraphQL query would look something like this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-graphql data-lang=graphql><span class=kd>query</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>  </span><span class=nc>listing</span><span class=p>(</span><span class=py>id</span><span class=p>:</span><span class=w> </span><span class=nc>123</span><span class=p>)</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>    </span><span class=py>id</span><span class=w>
</span><span class=w>    </span><span class=c># ... a bunch of other fields</span><span class=w>
</span><span class=w>    </span><span class=py>comments</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>      </span><span class=py>id</span><span class=w>
</span><span class=w>      </span><span class=py>body</span><span class=w>
</span><span class=w>      </span><span class=py>author</span><span class=w> </span><span class=p>{</span><span class=w>
</span><span class=w>        </span><span class=py>id</span><span class=w>
</span><span class=w>        </span><span class=py>username</span><span class=w>
</span><span class=w>      </span><span class=p>}</span><span class=w>
</span><span class=w>    </span><span class=p>}</span><span class=w>
</span><span class=w>  </span><span class=p>}</span><span class=w>
</span><span class=w></span><span class=p>}</span><span class=w>
</span></code></pre></div><p>Let&rsquo;s take a look at what would happen if your comment&rsquo;s author resolver is written naively and looks up the user immediately.</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kd>@Resolver</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>Comment</span><span class=p>)</span>
<span class=kr>export</span> <span class=kr>class</span> <span class=nx>CommentResolver</span> <span class=p>{</span>

  <span class=c1>// ... other resolvers
</span><span class=c1></span>
  <span class=kd>@FieldResolver</span><span class=p>(()</span> <span class=o>=&gt;</span> <span class=nx>User</span><span class=p>)</span>
  <span class=kr>async</span> <span class=nx>author</span><span class=p>(</span>
    <span class=kd>@Root</span><span class=p>()</span> <span class=p>{</span> <span class=nx>authorId</span> <span class=p>}</span><span class=o>:</span> <span class=nx>Comment</span><span class=p>,</span>
  <span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>User</span><span class=p>&gt;</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>user</span> <span class=o>=</span> <span class=k>await</span> <span class=nx>db</span><span class=p>(</span><span class=s1>&#39;users&#39;</span><span class=p>).</span><span class=nx>where</span><span class=p>({</span><span class=nx>id</span>: <span class=kt>authorId</span><span class=p>})[</span><span class=mi>0</span><span class=p>]</span>
    <span class=k>return</span> <span class=nx>toSchema</span><span class=p>(</span><span class=nx>user</span><span class=p>,</span> <span class=nx>User</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>In our application, we have a debug mode that outputs all the SQL queries that were used for every query that was run. This is what it outputs:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=p>{</span>
  <span class=nx>bindings</span><span class=o>:</span> <span class=p>[</span> <span class=mi>123</span> <span class=p>],</span>
  <span class=nx>sql</span><span class=o>:</span> <span class=s1>&#39;select * from &#34;listings&#34; where &#34;id&#34; = ?&#39;</span>
<span class=p>}</span>
<span class=p>{</span>
  <span class=nx>bindings</span><span class=o>:</span> <span class=p>[</span> <span class=mi>123</span> <span class=p>],</span>
  <span class=nx>sql</span><span class=o>:</span> <span class=s1>&#39;select * from &#34;comments&#34; where &#34;listing_id&#34; = ?&#39;</span>
<span class=p>}</span>
<span class=p>{</span>
  <span class=nx>bindings</span><span class=o>:</span> <span class=p>[</span> <span class=mi>5</span> <span class=p>],</span>
  <span class=nx>sql</span><span class=o>:</span> <span class=s1>&#39;select * from &#34;users&#34; where &#34;id&#34; = ?&#39;</span>
<span class=p>}</span>
<span class=p>{</span>
  <span class=nx>bindings</span><span class=o>:</span> <span class=p>[</span> <span class=mi>12</span> <span class=p>],</span>
  <span class=nx>sql</span><span class=o>:</span> <span class=s1>&#39;select * from &#34;users&#34; where &#34;id&#34; = ?&#39;</span>
<span class=p>}</span>
<span class=p>{</span>
  <span class=nx>bindings</span><span class=o>:</span> <span class=p>[</span> <span class=mi>1</span> <span class=p>],</span>
  <span class=nx>sql</span><span class=o>:</span> <span class=s1>&#39;select * from &#34;users&#34; where &#34;id&#34; = ?&#39;</span>
<span class=p>}</span>
<span class=p>{</span>
  <span class=nx>bindings</span><span class=o>:</span> <span class=p>[</span> <span class=mi>19</span> <span class=p>],</span>
  <span class=nx>sql</span><span class=o>:</span> <span class=s1>&#39;select * from &#34;users&#34; where &#34;id&#34; = ?&#39;</span>
<span class=p>}</span>
</code></pre></div><p>As you can see, there are four identical select statements on the users table where only the bindings change. This is because there are four comments on the listing and each comment calls the author resolver and makes its own database query. As the number of comments increases, the number of database queries would also increase. This is a huge performance issue.</p>
<h2 id=data-loaders>Data Loaders</h2>
<p>Using the example above, Data Loaders will collect the individual user IDs in the resolver and fetch the collected user IDs in one SQL query after <a href=https://nodejs.org/en/docs/guides/event-loop-timers-and-nexttick/ target=_blank rel="noopener noreffer">nextTick</a>. It will then return the appropriate User object based on the supplied user ID.</p>
<p>We decided to use the excellent and well supported <a href=https://github.com/graphql/dataloader target=_blank rel="noopener noreffer"><code>dataloader</code></a> package in our project. We then created a <code>SimpleLoader</code> to interface with our Repositories, which are responsible for loading Database Models in batch. Here is the code:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=c1>// utils/SimpleLoader.ts
</span><span class=c1></span><span class=kr>import</span> <span class=nx>DataLoader</span> <span class=kr>from</span> <span class=s1>&#39;dataloader&#39;</span>

<span class=kr>export</span> <span class=kr>interface</span> <span class=nx>Identifiable</span> <span class=p>{</span>
  <span class=nx>id</span>: <span class=kt>string</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=kr>interface</span> <span class=nx>GetBatch</span><span class=p>&lt;</span><span class=nt>T</span> <span class=na>extends</span> <span class=na>Identifiable</span><span class=p>&gt;</span> <span class=p>{</span>
  <span class=nx>getBatch</span><span class=o>:</span> <span class=p>(</span><span class=nx>ids</span>: <span class=kt>readonly</span> <span class=kt>string</span><span class=p>[])</span> <span class=o>=&gt;</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>T</span><span class=err>[]</span><span class=p>&gt;</span>
<span class=p>}</span>

<span class=kr>export</span> <span class=kr>class</span> <span class=nx>SimpleLoader</span><span class=p>&lt;</span><span class=nt>T</span> <span class=na>extends</span> <span class=na>Identifiable</span><span class=p>&gt;</span> <span class=p>{</span>
  <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>loader</span>: <span class=kt>DataLoader</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>T</span><span class=p>&gt;</span>

  <span class=kr>constructor</span><span class=p>(</span><span class=kr>protected</span> <span class=kr>readonly</span> <span class=nx>repo</span>: <span class=kt>GetBatch</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;)</span> <span class=p>{</span>
    <span class=k>this</span><span class=p>.</span><span class=nx>loader</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>DataLoader</span><span class=p>&lt;</span><span class=nt>string</span><span class=err>,</span> <span class=na>T</span><span class=p>&gt;(</span><span class=k>this</span><span class=p>.</span><span class=nx>loadBatch</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>))</span>
  <span class=p>}</span>

  <span class=kr>async</span> <span class=nx>load</span><span class=p>(</span><span class=nx>id</span>: <span class=kt>string</span><span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>T</span><span class=p>&gt;</span> <span class=p>{</span>
    <span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>loader</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>id</span><span class=p>)</span>
  <span class=p>}</span>

  <span class=kr>private</span> <span class=kr>async</span> <span class=nx>loadBatch</span><span class=p>(</span><span class=nx>keys</span>: <span class=kt>readonly</span> <span class=kt>string</span><span class=p>[])</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>T</span><span class=err>[]</span><span class=p>&gt;</span> <span class=p>{</span>
    <span class=kr>const</span> <span class=nx>objects</span> <span class=o>=</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>repo</span><span class=p>.</span><span class=nx>getBatch</span><span class=p>(</span><span class=nx>keys</span><span class=p>)</span>
    <span class=kr>const</span> <span class=nx>lookup</span> <span class=o>=</span> <span class=nx>objects</span><span class=p>.</span><span class=nx>reduce</span><span class=p>&lt;</span><span class=nt>Record</span><span class=err>&lt;</span><span class=na>string</span><span class=err>,</span> <span class=na>T</span><span class=p>&gt;</span><span class=o>&gt;</span><span class=p>((</span><span class=nx>acc</span><span class=p>,</span> <span class=kt>object</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span>
      <span class=nx>acc</span><span class=p>[</span><span class=kt>object</span><span class=p>.</span><span class=nx>id</span><span class=p>]</span> <span class=o>=</span> <span class=kt>object</span>
      <span class=k>return</span> <span class=nx>acc</span>
    <span class=p>},</span> <span class=p>{})</span>
    <span class=k>return</span> <span class=nx>keys</span><span class=p>.</span><span class=nx>map</span><span class=p>((</span><span class=nx>key</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=nx>lookup</span><span class=p>[</span><span class=nx>key</span><span class=p>])</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>There are two interfaces here.</p>
<p>The <code>Identifiable</code> interface is meant to be implemented on the Model. It ensures the <code>id</code> method is available for sorting the returned Models based on the order of the <code>keys</code> input argument in <code>loadBatch</code> method.</p>
<p>The <code>GetBatch</code> interface is meant to be implemented on the Repository. We use <code>getBatch</code> method to fetch Models all in one go.</p>
<p>For each Model & Repository pair, we will create a new <code>SimpleLoader</code>. Using the User example above, we define a <code>UserLoader</code> like this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>import</span> <span class=p>{</span> <span class=nx>Service</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;typedi&#39;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>SimpleLoader</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../utils/SimpleLoader&#39;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>UserRepository</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../repositories&#39;</span>

<span class=kd>@Service</span><span class=p>()</span>
<span class=kr>export</span> <span class=kr>class</span> <span class=nx>UserLoader</span> <span class=kr>extends</span> <span class=nx>SimpleLoader</span><span class=p>&lt;</span><span class=nt>Domain.User</span><span class=p>&gt;</span> <span class=p>{</span>
  <span class=kr>constructor</span><span class=p>(</span><span class=kr>protected</span> <span class=kr>readonly</span> <span class=nx>repo</span>: <span class=kt>UserRepository</span><span class=p>)</span> <span class=p>{</span>
    <span class=kr>super</span><span class=p>(</span><span class=nx>repo</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div><p>We are using <a href=https://github.com/typestack/typedi target=_blank rel="noopener noreffer"><code>typedi</code></a> for <a href=https://www.jamesshore.com/v2/blog/2006/dependency-injection-demystified target=_blank rel="noopener noreffer">Dependency Injection</a>. We also used a feature in <code>typedi</code>, called <a href=https://docs.typestack.community/typedi/v/develop/#using-multiple-containers-and-scoped-containers target=_blank rel="noopener noreffer">Scoped Containers</a> to ensure each new GraphQL request will have its own empty container for dependency injections. This is a topic for another time. The TL;DR reason for this setup is to ensure a new instance of <code>UserLoader</code> is created in the beginning of the request and is thrown away when the request is complete. This is important because <code>dataloader</code> performs <a href=https://github.com/graphql/dataloader#caching target=_blank rel="noopener noreffer">caching</a>, and recommend to initialize it during request initialization and throw it away after a request is complete.</p>
<p>To use the <code>UserLoader</code>, all you have to do in your resolver is this:</p>
<div class=highlight><pre tabindex=0 class=chroma><code class=language-typescript data-lang=typescript><span class=kr>import</span> <span class=p>{</span> <span class=nx>Service</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;typedi&#39;</span>
<span class=kr>import</span> <span class=p>{</span> <span class=nx>UserLoader</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;../loaders&#39;</span>

<span class=kd>@Service</span><span class=p>()</span>
<span class=kr>export</span> <span class=kr>class</span> <span class=nx>CommentResolver</span> <span class=p>{</span>
  <span class=kr>constructor</span><span class=p>(</span>
    <span class=kr>private</span> <span class=kr>readonly</span> <span class=nx>loader</span>: <span class=kt>UserLoader</span><span class=p>,</span>
    <span class=c1>// a bunch of other injected services
</span><span class=c1></span>  <span class=p>)</span> <span class=p>{}</span>

  <span class=kr>async</span> <span class=nx>user</span><span class=p>(</span>
    <span class=kd>@Root</span><span class=p>()</span> <span class=nx>comment</span>: <span class=kt>Comment</span><span class=p>,</span>
  <span class=p>)</span><span class=o>:</span> <span class=nx>Promise</span><span class=p>&lt;</span><span class=nt>Domain.Listing</span><span class=p>&gt;</span> <span class=p>{</span>
    <span class=c1>// using the loader here
</span><span class=c1></span>    <span class=k>return</span> <span class=k>await</span> <span class=k>this</span><span class=p>.</span><span class=nx>loader</span><span class=p>.</span><span class=nx>load</span><span class=p>(</span><span class=nx>comment</span><span class=p>.</span><span class=nx>authorId</span><span class=p>)</span>
  <span class=p>}</span>
<span class=p>}</span>
</code></pre></div></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2021-10-01</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md></div>
<div class=post-info-share>
<span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/ data-title="Graphql Performance Optimization" data-via=aq1018 data-hashtags=graphql,typescript,type-graphql,typdi,optimization><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/ data-hashtag=graphql><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://softwareunicorns.com/posts/graphql-typedi-data-loaders-and-scoped-containers/><i class="fab fa-linkedin fa-fw"></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/graphql/>graphql</a>,&nbsp;<a href=/tags/typescript/>typescript</a>,&nbsp;<a href=/tags/type-graphql/>type-graphql</a>,&nbsp;<a href=/tags/typdi/>typdi</a>,&nbsp;<a href=/tags/optimization/>optimization</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span>
</section>
</div>
<div class=post-nav><a href=/posts/google-wellbeing-manifesto/ class=prev rel=prev title="Mental Health Is Your Priority Number One"><i class="fas fa-angle-left fa-fw"></i>Mental Health Is Your Priority Number One</a>
<a href=/posts/messy-ui-think-in-components/ class=next rel=next title="Messy UI? Think In Components, Not HTML & CSS">Messy UI? Think In Components, Not HTML & CSS<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments><div id=disqus_thread class=comment></div><noscript>
Please enable JavaScript to view the comments powered by <a href=https://disqus.com/?ref_noscript>Disqus</a>.
</noscript></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.88.1">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.10"><i class="far fa-kiss-wink-heart fa-fw"></i> LoveIt</a>
</div><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2021</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/about target=_blank>Aaron Qian</a></span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw"></i>
</a>
</div><script type=text/javascript src=https://softwareunicorns.disqus.com/embed.js defer></script><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:500},comment:{}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-CR6HY18MJR',{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-CR6HY18MJR" async></script></body>
</html>